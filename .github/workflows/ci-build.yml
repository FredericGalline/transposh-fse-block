name: ðŸ§± WordPress Build â€“ Blocs Gutenberg

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  build-blocks:
    name: ðŸ”¨ Build des blocs Gutenberg
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Cloner le dÃ©pÃ´t
        uses: actions/checkout@v3

      - name: ðŸ”Ž Trouver les dossiers de blocs
        id: list-blocks
        run: |
          echo "::set-output name=dirs::$(find blocks -type f -name package.json -exec dirname {} \; | paste -sd ' ' -)"

      - name: ðŸ§¶ Installer et builder chaque bloc
        run: |
          for dir in ${{ steps.list-blocks.outputs.dirs }}; do
            echo "ðŸ“¦ Traitement de $$dir"
            cd $dir
            npm ci || npm install
            npm run build
            cd - > /dev/null
          done
